Janus CVE-2017-13156 PoC

usage: janus.py dex apk out_apk

Android package installer does NOT check extra data before PKZIP, thus concat DEX+APK together and little bit of fix, installation passed.

ART can run both APK and DEX, so here DEX ahead of base.apk is actually the one to execute.

 * extract the original classes.dex
 * use APKTOOL to do stuffs on it
 * fuse the new dex into original APK
 * update the installed app :)

This vulnerability was found by GuardSquare https://www.guardsquare.com/en/blog/new-android-vulnerability-allows-attackers-modify-apps-without-affecting-their-signatures

FAQ:

 * Why my generated apk crashes?

You may have seen this in logcat:

```04-24 00:01:47.162  4330  4330 E AndroidRuntime: java.lang.RuntimeException: Unable to get provider jakhar.aseem.diva.NotesProvider: java.lang.ClassNotFoundException: Didn't find class "jakhar.aseem.diva.NotesProvider" on path: DexPathList[[zip file "/data/app/jakhar.aseem.diva-1/base.apk"],nativeLibraryDirectories=[/data/app/jakhar.aseem.diva-1/lib/x86, /data/app/jakhar.aseem.diva-1/base.apk!/lib/x86, /vendor/lib, /system/lib]]
04-24 00:01:47.162  4330  4330 E AndroidRuntime: Caused by: java.lang.ClassNotFoundException: Didn't find class "jakhar.aseem.diva.NotesProvider" on path: DexPathList[[zip file "/data/app/jakhar.aseem.diva-1/base.apk"],nativeLibraryDirectories=[/data/app/jakhar.aseem.diva-1/lib/x86, /data/app/jakhar.aseem.diva-1/base.apk!/lib/x86, /vendor/lib, /system/lib]]
```

The essential reason is Android still using the original AndroidManifest.xml to parse the app (mainly your new DEX).

So it's good idea to setup a new project with the original AndroidManifest.xml, and fix providers, receivers, exported activities. You don't need to write them well, just auto-generate null dummy classes.
